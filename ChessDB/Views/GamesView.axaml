<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:ChessDB.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="550"
             x:Class="ChessDB.Views.GamesView"
             x:DataType="vm:GamesViewModel">

  <StackPanel Margin="12" Spacing="10">
    <TextBlock Text="Encodage des parties" FontSize="16" FontWeight="Bold"/>

    <StackPanel Orientation="Horizontal" Spacing="20">
      
      <StackPanel Spacing="5">
        <TextBlock Text="Compétition" FontWeight="SemiBold"/>
        <ComboBox Width="250"
                  ItemsSource="{Binding AvailableCompetitions}"
                  SelectedValue="{Binding SelectedCompetitionId, Mode=TwoWay}"
                  SelectedValueBinding="{Binding Id}"
                  DisplayMemberBinding="{Binding Name}"
                  PlaceholderText="Choisir une compétition..."/>
      </StackPanel>

      <StackPanel Spacing="5">
        <TextBlock Text="Joueur Blancs" FontWeight="SemiBold"/>
        <ComboBox Width="200"
                  ItemsSource="{Binding AvailablePlayers}"
                  SelectedValue="{Binding SelectedWhitePlayer, Mode=TwoWay}"
                  SelectedValueBinding="{Binding Id}"
                  DisplayMemberBinding="{Binding FullName}"
                  PlaceholderText="Joueur 1"/>
      </StackPanel>

      <StackPanel Spacing="5">
        <TextBlock Text="Joueur Noirs" FontWeight="SemiBold"/>
        <ComboBox Width="200"
                  ItemsSource="{Binding AvailablePlayers}"
                  SelectedValue="{Binding SelectedBlackPlayer, Mode=TwoWay}"
                  SelectedValueBinding="{Binding Id}"
                  DisplayMemberBinding="{Binding FullName}"
                  PlaceholderText="Joueur 2"/>
      </StackPanel>
    </StackPanel>

    <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,10,0,0">
      <StackPanel Spacing="5">
          <TextBlock Text="Résultat" FontWeight="SemiBold"/> 
          <ComboBox Width="120" 
                    ItemsSource="{Binding PossibleResults}"
                    SelectedItem="{Binding Result}"/>
      </StackPanel>

      <StackPanel Spacing="5" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
          <TextBlock Text="Coups" FontWeight="SemiBold"/>
          <TextBox Width="400" 
          Watermark="Séparez par une virgule (ex: Pion en D-15, Fou en F-4...)" 
          Text="{Binding MovesInput}"/>
      </StackPanel>

      <Button Content="Enregistrer Partie" 
              Command="{Binding AddGameCommand}" 
              VerticalAlignment="Bottom"
              Margin="10,0,0,0"/>
    </StackPanel>

    <TextBlock Text="Historique des parties" Margin="0,15,0,5" FontWeight="SemiBold"/>
    <Border BorderBrush="Gray" BorderThickness="1" CornerRadius="4">
      <ListBox ItemsSource="{Binding Games}" Height="250">
        <ListBox.ItemTemplate>
          <DataTemplate>
            <Grid ColumnDefinitions="Auto, *, Auto, Auto" Margin="5">
                <TextBlock Grid.Column="0" 
                          Text="{Binding PlayedAt, StringFormat='{}{0:yyyy-MM-dd}'}" 
                          Foreground="Gray" Margin="0,0,15,0" VerticalAlignment="Center"/>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="{Binding WhitePlayer.FullName}" FontWeight="Bold"/>
                    <TextBlock Text=" vs " Margin="5,0"/>
                    <TextBlock Text="{Binding BlackPlayer.FullName}" FontWeight="Bold"/>
                </StackPanel>

                <TextBlock Grid.Column="2" 
                          Text="{Binding Result}" 
                          FontWeight="Bold" Margin="15,0" VerticalAlignment="Center"/>

                <Button Grid.Column="3" 
                        Content="Voir les coups" 
                        FontSize="12"
                        Click="OnOpenDetailsClick" 
                        Tag="{Binding}"/> 
            </Grid>
          </DataTemplate>
        </ListBox.ItemTemplate>
      </ListBox>
    </Border>

  </StackPanel>
</UserControl>