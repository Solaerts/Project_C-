<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:ChessDB.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="550"
             x:Class="ChessDB.Views.GamesView"
             x:DataType="vm:GamesViewModel">

  <StackPanel Margin="12" Spacing="10">
    <TextBlock Text="Encodage des parties" FontSize="16" FontWeight="Bold"/>

    <StackPanel Orientation="Horizontal" Spacing="20">
      
      <StackPanel Spacing="5">
        <TextBlock Text="Compétition" FontWeight="SemiBold"/>
        <ComboBox Width="250"
                  ItemsSource="{Binding DataContext.CompetitionsVM.Competitions, RelativeSource={RelativeSource AncestorType=Window}}"
                  SelectedValue="{Binding SelectedCompetitionId, Mode=TwoWay}"
                  SelectedValueBinding="{Binding Id}"
                  DisplayMemberBinding="{Binding Name}"
                  PlaceholderText="Choisir une compétition..."/>
      </StackPanel>

      <StackPanel Spacing="5">
        <TextBlock Text="Joueur Blancs" FontWeight="SemiBold"/>
        <ComboBox Width="200"
                  ItemsSource="{Binding DataContext.PlayersVM.Players, RelativeSource={RelativeSource AncestorType=Window}}"
                  SelectedValue="{Binding SelectedWhitePlayer, Mode=TwoWay}"
                  SelectedValueBinding="{Binding Id}"
                  DisplayMemberBinding="{Binding FullName}"
                  PlaceholderText="Joueur 1"/>
      </StackPanel>

      <StackPanel Spacing="5">
        <TextBlock Text="Joueur Noirs" FontWeight="SemiBold"/>
        <ComboBox Width="200"
                  ItemsSource="{Binding DataContext.PlayersVM.Players, RelativeSource={RelativeSource AncestorType=Window}}"
                  SelectedValue="{Binding SelectedBlackPlayer, Mode=TwoWay}"
                  SelectedValueBinding="{Binding Id}"
                  DisplayMemberBinding="{Binding FullName}"
                  PlaceholderText="Joueur 2"/>
      </StackPanel>
    </StackPanel>

    <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,10,0,0">
      <StackPanel Spacing="5">
          <TextBlock Text="Résultat" FontWeight="SemiBold"/>
          <ComboBox Width="120" SelectedItem="{Binding Result}">
            <ComboBoxItem Content="1-0"/>
            <ComboBoxItem Content="0-1"/>
            <ComboBoxItem Content="1/2-1/2"/>
          </ComboBox>
      </StackPanel>

      <StackPanel Spacing="5" HAlign="Stretch" VerticalAlignment="Stretch">
          <TextBlock Text="Coups (PGN)" FontWeight="SemiBold"/>
          <TextBox Width="400" Watermark="ex: 1. e4 e5 2. Nf3 ..." Text="{Binding MovesInput}"/>
      </StackPanel>

      <Button Content="Enregistrer Partie" 
              Command="{Binding AddGameCommand}" 
              VerticalAlignment="Bottom"
              Margin="10,0,0,0"/>
    </StackPanel>

    <TextBlock Text="Historique des parties" Margin="0,15,0,5" FontWeight="SemiBold"/>
    <Border BorderBrush="Gray" BorderThickness="1" CornerRadius="4">
        <ListBox ItemsSource="{Binding Games}" Height="250">
          <ListBox.ItemTemplate>
            <DataTemplate>
              <Grid ColumnDefinitions="Auto, *, Auto, Auto" Margin="5">
                  <TextBlock Grid.Column="0" 
                             Text="{Binding PlayedAt, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" 
                             Foreground="Gray" Margin="0,0,15,0" VerticalAlignment="Center"/>
                  
                  <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                      <TextBlock Text="{Binding WhitePlayer.FullName, FallbackValue='White'}" FontWeight="Bold"/>
                      <TextBlock Text=" vs " Margin="5,0"/>
                      <TextBlock Text="{Binding BlackPlayer.FullName, FallbackValue='Black'}" FontWeight="Bold"/>
                  </StackPanel>

                  <TextBlock Grid.Column="2" 
                             Text="{Binding Result, StringFormat='Résultat: {0}'}" 
                             FontWeight="Bold" Margin="15,0" VerticalAlignment="Center"/>

                  <TextBlock Grid.Column="3" 
                             Text="{Binding Moves}" 
                             FontStyle="Italic" Foreground="Gray" 
                             TextTrimming="CharacterEllipsis" MaxWidth="150" VerticalAlignment="Center"/>
              </Grid>
            </DataTemplate>
          </ListBox.ItemTemplate>
        </ListBox>
    </Border>

  </StackPanel>
</UserControl>